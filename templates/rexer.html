<!-- Styles -->
<style>
    #chartdiv {
      width: 100%;
      height: 400px;
    }
  </style>
  
  <!-- Resources -->
  <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
  
  <!-- Chart code -->
  <script>
    am4core.ready(function () {
  
      // Themes begin
      am4core.useTheme(am4themes_animated);
      // Themes end
  
      /**
       * Source data
       */
      var data = [{
        "category": "product1",
        "value": 50,
        "color": am4core.color("#dc4534"),
        "breakdown": [{
          "category": "positive",
          "value": 50
        }, {
          "category": "negative",
          "value": 24
        }, {
          "category": "neutral",
          "value": 26
        }]
      }, {
        "category": "product2",
        "value": 25,
        "color": am4core.color("#d7a700"),
        "breakdown": [{
          "category": "positive",
          "value": 25
        }, {
          "category": "negative",
          "value": 50
        }, {
          "category": "neutral",
          "value": 25
        }]
      }];
  
      /**
       * Chart container
       */
  
      // Create chart instance
      var chart = am4core.create("chartdiv", am4core.Container);
      chart.width = am4core.percent(100);
      chart.height = am4core.percent(100);
      chart.layout = "horizontal";
  
      // Variable to keep track of the current sub-pie chart
      var currentSubPieChart;
  
      /**
       * Bar chart
       */
  
      // Create chart instance
      var barChart = chart.createChild(am4charts.XYChart);
      barChart.data = data;
      barChart.padding(15, 15, 15, 15);
  
      // Create axes
      var categoryAxis = barChart.xAxes.push(new am4charts.CategoryAxis());
      categoryAxis.dataFields.category = "category";
      categoryAxis.renderer.grid.template.location = 0;
      categoryAxis.renderer.inversed = true;
  
      var valueAxis = barChart.yAxes.push(new am4charts.ValueAxis());
  
      // Create series
      var barSeries = barChart.series.push(new am4charts.ColumnSeries());
      barSeries.dataFields.valueY = "value";
      barSeries.dataFields.categoryX = "category";
      barSeries.columns.template.strokeWidth = 0;
  
      // Set up toggling events
      barSeries.columns.template.events.on("hit", function (ev) {
        // Check if there is an existing sub-pie chart
        if (currentSubPieChart) {
          // Hide the existing sub-pie chart
          currentSubPieChart.dispose();
          currentSubPieChart = null;
        }
  
        // Create a new sub-pie chart
        var clickedSegmentData = ev.target.dataItem.dataContext.breakdown;
        createSubPieChart(clickedSegmentData);
      });
  
      // Function to create and display a sub pie chart
      function createSubPieChart(data) {
        // Create a new pie chart
        var subPieChart = chart.createChild(am4charts.PieChart);
        subPieChart.width = am4core.percent(100);
        subPieChart.height = am4core.percent(100);
        subPieChart.innerRadius = am4core.percent(50);
        subPieChart.data = data;
  
        // Add and configure Series
        var subPieSeries = subPieChart.series.push(new am4charts.PieSeries());
        subPieSeries.dataFields.value = "value";
        subPieSeries.dataFields.category = "category";
        subPieSeries.slices.template.propertyFields.fill = "color";
        subPieSeries.labels.template.disabled = true;
  
        // Set up toggling events for the sub pie chart
        subPieSeries.slices.template.events.on("hit", function (ev) {
          // Handle the click on a slice in the sub pie chart if needed
          // You can add logic here to perform actions based on the clicked sub pie segment
          console.log("Sub Pie Segment Clicked:", ev.target.dataItem.dataContext);
        });
  
        // Update labels for the sub pie chart
        subPieSeries.slices.template.events.on("ready", function (ev) {
          // Auto-select first slice on load
          subPieSeries.slices.getIndex(0).isActive = true;
        });
  
        // Keep track of the current sub-pie chart
        currentSubPieChart = subPieChart;
      }
  
    }); // end am4core.ready()
  </script>
  
  <!-- HTML -->
  <div id="chartdiv"></div>
  